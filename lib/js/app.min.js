angular.module("shopular",["ui.router","LocalStorageModule"]).config(function(a,b){b.otherwise("/"),a.state("inv",{url:"/",abstract:!0,template:"<ui-view></ui-view>"}).state("inv.login",{url:"",templateUrl:"src/views/login.html",controller:"loginInvCtrl as login"}).state("inv.manage",{url:"inventory",abstract:!0,templateUrl:"src/views/manage.html",controller:"loginInvCtrl as login"}).state("inv.manage.new",{url:"/new",templateUrl:"src/views/new.html",controller:"newInvCtrl as newInv"}).state("inv.manage.list",{url:"/list",templateUrl:"src/views/list.html",controller:"listInvCtrl as listInv"})}),angular.module("shopular").factory("Item",function(){var a=.0575;return function(b){b=b||{},this.id=b.id||Date.now(),this.name=b.name||"",this.price=b.price||0,this.quantity=b.quantity||0,this.color=b.color||"",this.discount=b.discount||0,this.totalPrice=b.price*(1+a)-b.discount||0,this.editing=!1}}),angular.module("shopular").service("Items",function(a,b){function c(){return b.get("items")||[]}function d(a){b.set("items",a)}function e(a,b){var c;return a.forEach(function(a){a.id===b&&(c=a)}),c}this.update=function(a){var b=c(),f=e(b,a.id);angular.copy(a,f),d(b)},this.fetch=function(){return c()},this.create=function(b){var e=c(),f=new a(b);e.push(f),d(e)},this.reset=function(){var a=[];d(a)}}),angular.module("shopular").controller("listInvCtrl",function(a,b){this.items=a.fetch()||[],this.sortOrder="totalPrice",this.sortReverse=!1,this.sortBy=function(a){this.sortOrder=a,this.sortReverse=!this.sortReverse},this.updateItem=function(b){b.editing=!1,a.update(b)},this.startEditing=function(a){a.editing=!0}}),angular.module("shopular").controller("loginInvCtrl",function(a,b){this.username="",this.currentUser=a.fetchCurrent()||{username:"Not logged in",signInDate:0},console.log(this.currentUser),this.newLogin=function(c){a.checkLogin(c),b.go("inv.manage.new")}}),angular.module("shopular").controller("newInvCtrl",function(a,b){this.newItem={name:null,price:null,quantity:null,color:null,discount:null},this.addNew=function(){console.log(this.newItem),a.create(this.newItem),b.go("inv.manage.list")},this.getInit=function(){var c=[{id:2957,name:"widget",price:32,quantity:203,color:"red",discount:31},{id:89274,name:"golf club",price:98,quantity:10,color:"black",discount:0},{id:64,name:"iPhone",price:499,quantity:2,color:"white",discount:0},{id:87363,name:"bonzai tree",price:76,quantity:2,color:"green",discount:0},{id:1736,name:"towel",price:55,quantity:30,color:"brown",discount:10},{id:4836,name:"dog bed",price:99,quantity:10,color:"beige",discount:50},{id:829,name:"waste basket",price:15,quantity:40,color:"silver",discount:0},{id:46,name:"guitar",price:899,quantity:0,color:"blue",discount:150},{id:17456,name:"matcha tea",price:42,quantity:4,color:"green",discount:11},{id:3292,name:"enlightenment",price:99999,quantity:1,color:"red",discount:0},{id:533,name:"eggs",price:5,quantity:12,color:"brown",discount:1},{id:683,name:"pillow",price:27,quantity:10,color:"black",discount:12}];c.forEach(function(b){a.create(b)}),b.go("inv.manage.list")},this.resetInv=function(){a.reset(),b.go("inv.manage.list")}}),angular.module("shopular").factory("User",function(){return function(a){this.id=Date.now(),this.username=a||"",this.signInDate=Date.now()}}),angular.module("shopular").service("Users",function(a,b){function c(){return b.get("users")||[]}function d(a){b.set("users",a),b.set("currentUser",currentUser)}function e(a,b){var c;return a.forEach(function(a){a.username===b&&(c=a)}),c}currentUser=b.get("currentUser")||{username:"Not Logged In",signInDate:0},this.update=function(a){var b=c(),f=e(b,a.username);angular.copy(a,f),currentUser=f,d(b)},this.fetchAll=function(){return c()},this.fetchCurrent=function(){return b.get("currentUser")||currentUser},this.create=function(b){var e=c(),f=new a(b);currentUser=f,e.push(f),d(e)},this.reset=function(){var a=[];d(a)},this.checkLogin=function(a){var b=c(),d=e(b,a);d?(d.signInDate=Date.now(),this.update(d)):this.create(a)}});